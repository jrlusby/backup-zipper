#! /usr/bin/env python3

import sys
import os
import zipfile

def main(argv):
    destination = "dst.zip"
    filelist = process_backups(argv[1])
    zip(filelist, destination)
    # upload zip to remote
    # upload_arc(destination, '192.168.26.80', 'support', 'asai1234')

def zip(files, dst):
    zf = zipfile.ZipFile(dst, "w")
    for absname in files:
        # print(absname)
        basename = os.path.basename(absname)
        # print(basename)
        arcname = os.path.join(dst, basename)
        # print(arcname)
        zf.write(absname, arcname)
    zf.close()

def process_backups(src):
    filelist = os.listdir(src)
    filelist[:] = [os.path.join(src, file) for file in filelist]
    return filelist
    
def upload_arc(archive, target_dir, destination, username, password):
    from ftplib import FTP
    try:
        ftp = FTP(destination)
        ftp.login(user=username, passwd=password)
        ftp.cwd(target_dir)
        file = open(archive, 'rb')
        ftp.storbinary('STOR '+archive, file)
        file.close()
        ftp.quit()
    except:
        print('whoa wtf happened?', sys.exc_info()[0])

if __name__ == '__main__':
    sys.exit(main(sys.argv))
